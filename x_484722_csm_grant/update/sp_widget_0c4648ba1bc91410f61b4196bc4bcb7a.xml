<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_widget">
    <sp_widget action="INSERT_OR_UPDATE">
        <category>custom</category>
        <client_script><![CDATA[function($rootScope,$scope,spUtil) {
	/* widget controller */
	var c = this;
	// position indicator
	c.notePos = 0;
	var url = window.parent.location.href;
	var str = url.split(".")[0];

	c.data.row_count = c.data.notes.length;
	c.data.window_size = 2;	//Rows number in one page
	c.data.p = 1;
	c.data.num_pages = Math.ceil(c.data.row_count / c.data.window_size);
	c.data.window_start = 0;
	c.data.window_end = c.data.num_pages -1;
	$scope.pagedata = c.data.notes.slice(0, c.data.window_size);

	c.selectItem = function(idx) {  
		// Set the position indicator to the index value passed in on select
		c.notePos = idx;
		var id = c.data.notes[idx].sys_id;
		c.data.url = str + '.service-now.com/csmg?id=grant_detail&sys_id=' + id;
		$rootScope.noteID = id;
	}

	$scope.getNumber = function(num) {
		return new Array(num);
	};
	$scope.setPageNum = function(num) {
		c.data.p = num;
		getData();
	};
	function getData() {
		var start = (c.data.p-1)*c.data.window_size
		var end = Math.min(c.data.row_count, c.data.p*c.data.window_size)
		$scope.pagedata = c.data.notes.slice(start, end)
	}

}
]]></client_script>
        <controller_as>c</controller_as>
        <css>h3.panel-title {
  font-size:20px;
  padding-top:5px;
}</css>
        <data_table>sp_instance</data_table>
        <demo_data/>
        <description/>
        <docs/>
        <field_list/>
        <has_preview>true</has_preview>
        <id>grant_list</id>
        <internal>false</internal>
        <link><![CDATA[function link(scope, element, attrs, controller) {  }]]></link>
        <name>Grant List</name>
        <option_schema>[{"hint":"Specify a title for the Notes List widget","name":"title","section":"other","default_value":"Notes","label":"Title","type":"string"},{"hint":"Select the maximum number of records to display","name":"maximum_records_to_display","section":"other","default_value":"5","label":"Maximum records to display","type":"choice","choices":[{"label":"2","value":"2"},{"label":"3","value":"3"},{"label":"5","value":"5"},{"label":"7","value":"7"},{"label":"11","value":"11"},{"label":"13","value":"13"},{"label":"17","value":"17"}]}]</option_schema>
        <public>true</public>
        <roles/>
        <script><![CDATA[(function() {

	data.notes = [];
	var noteGR = new GlideRecord('pc_product_cat_item');
	noteGR.addQuery('model', '7c5e98071ba5d0107bd3dce9bc4bcb2f');
	noteGR.orderBy('name');
	noteGR.setLimit(options.maximum_records_to_display);
	noteGR.query();
	while (noteGR.next()) {
		var noteObj = {};

		$sp.getRecordDisplayValues(noteObj, noteGR, 'short_description,description,specs,sys_id');

		noteObj.name = noteGR.getValue('name').slice(0,100);
//		noteObj.u_purpose_outline_summary = noteGR.getValue('u_purpose_outline_summary').slice(0,100);
//		noteObj.u_target_person = noteGR.getValue('u_target_person').slice(0,100);
//		noteObj.u_recruitment_period = noteGR.getValue('u_recruitment_period').slice(0,100);

		data.notes.push(noteObj);
	}


}
)();]]></script>
        <servicenow>false</servicenow>
        <sys_class_name>sp_widget</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-05-31 13:43:00</sys_created_on>
        <sys_id>0c4648ba1bc91410f61b4196bc4bcb7a</sys_id>
        <sys_mod_count>43</sys_mod_count>
        <sys_name>Grant List</sys_name>
        <sys_package display_value="CSM Grant" source="x_484722_csm_grant">1de344b61bc91410f61b4196bc4bcbbb</sys_package>
        <sys_policy/>
        <sys_scope display_value="CSM Grant">1de344b61bc91410f61b4196bc4bcbbb</sys_scope>
        <sys_update_name>sp_widget_0c4648ba1bc91410f61b4196bc4bcb7a</sys_update_name>
        <sys_updated_by>nei.P04591@jsol.co.jp</sys_updated_by>
        <sys_updated_on>2020-07-01 11:24:44</sys_updated_on>
        <template><![CDATA[<div class="panel panel-default">
  <div class="panel-heading clearfix">
    <h3 class="panel-title pull-left">
      {{::c.options.title}}
    </h3>
  </div>
  <div class="panel-body"> 
    <input placeholder="Filter" class="form-control" ng-model="noteFilter" /> 
  </div>

  <table class="table table-bordered table-hover" style="min-width:800px;">
    <thead>
      <tr class="info">
        <th scope="col"width="5%">No.</th>
        <th scope="col"width="20%">補助金名</th>
        <th scope="col"width="35%">目的・概要</th>
        <th scope="col"width="30%">対象者</th>
        <th scope="col"width="10%">募集期間</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-click="c.selectItem($index)" ng-repeat="record in pagedata | filter: noteFilter">
        <td>{{ record.name }}</td>
        <td><a href="{{c.data.url}}">{{ record.short_description }}</a></td>
        <td>{{ record.description }}</td>
        <td>{{ record.specs }}</td>
        <td>2020-06-22 14:00 - 2020-08-31 23:59</td>
      </tr>
    </tbody>
  </table><br><br>
  <div class="panel-footer"  ng-if="data.row_count">
    <div class="btn-toolbar m-r pull-left">
      <div class="btn-group">
        <a ng-disabled="data.p == 1" href="javascript:void(0)" ng-click="setPageNum(data.p - 1)" class="btn btn-default" aria-label="${Previous page} {{data.p == 1 ? '${disabled}' : ''}}" tabindex="{{(data.p == 1) ? -1 : 0}}"><i class="fa fa-chevron-left"></i></a>
      </div>
      <div ng-if="data.num_pages > 1 && data.num_pages < 20" class="btn-group">
        <a ng-repeat="i in getNumber(data.num_pages) track by $index" ng-click="setPageNum($index + 1)" href="javascript:void(0)" ng-class="{active: ($index + 1) == data.p}" type="button" class="btn btn-default" aria-label="${Page} {{$index + 1}}">{{$index + 1}}</a>
      </div>
      <div class="btn-group">
        <a ng-disabled="data.p == data.num_pages" href="javascript:void(0)" ng-click="setPageNum(data.p + 1)" class="btn btn-default" aria-label="${Next page} {{data.p == data.num_pages ? '${disabled}' : ''}}" tabindex="{{(data.p == data.num_pages) ? -1 : 0}}"><i class="fa fa-chevron-right"></i></a>
      </div>
    </div>
    <span class="clearfix"></span>
  </div>

</div>]]></template>
    </sp_widget>
</record_update>
